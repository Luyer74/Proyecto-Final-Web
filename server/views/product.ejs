<%- include ("./templates/_header") %>
<section class="product">
    <div class="product-main">
        <div class="row p-5 text-center">
            <div class="col">
                <div class="product-phrase">
                    <h1 class="display-4"><%= product.name %> </h1>
                    <ul>
                        <% for( let index = 0; index < product.description.length; index++ ) { %>
                            <li class="list-unstyled h5"><%= product.description[index] %> </li>
                        <% } %>
                    </ul>
                    <div class="img-container text-center mt-5">
                        <img src="<%= product.img_url %> "
                            alt="" class="img-fluid product-img rounded shadow">
                    </div>
                    <br>
                    <h3>Precio: $ <%= product.price %> </h3>
                    <h3>Marca: <%= product.brand %> </h3>
                    <button type="button" class="btn btn-primary btn-lg mt-2" data-toggle="modal" id="addItem">Agregar a una lista</button> &nbsp;
                    <a href="<%= product.url %> " type="button" target="_blank" class="btn btn-light btn-lg mt-2" role="button">Comprar</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="showLists" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Mis Listas</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modal-lists">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $('#showLists').on('hidden.bs.modal', function (e) {
            $('#modal-lists').html("");
        })
    </script>
    <script>
        $('#addItem').on("click", () => {
            $.get('/lists/get', function(data){
                if(typeof(data) != "object"){
                    var par = document.createElement('p');
                    par.innerText = "No estÃ¡s registrado";
                    $('#modal-lists').append(par);
                }
                else if(data.length != 0){
                    data.forEach(element => {
                        var par = document.createElement('p');
                        par.innerText = element.name;
                        $('#modal-lists').append(par);
                        var button = document.createElement('button');
                        $(button).addClass('btn btn-primary submit-prod');
                        $(button).attr('type', 'button');
                        $(button).on("click", function(){
                            var urlString = `${window.location.pathname}/addToList`;
                            var data = {
                                list_id : element._id
                            }
                            $.post(urlString, data)
                            .then(function(data){
                                console.log(data);
                                window.location.href = `/lists/${element._id}`;
                            })
                        })
                        button.innerText = 'Agregar aqui';
                        $('#modal-lists').append(button);
                    });
                }
                else{
                    var par = document.createElement('p');
                    par.innerText = "No tienes listas creadas."
                    $('#modal-lists').append(par);
                }
            });
            $('#showLists').modal('show');
        })
    </script>
</section>
<%- include ("./templates/_footer") %>